<html>

	<header>
		<title>Canvas test</title>
	</header>
	<style type="text/css">
		#container {  
			width: 100%;
			height: 100%;

			/* Firefox */
			display:-moz-box;
			-moz-box-orient:horizontal;
			-moz-box-pack:center;
			-moz-box-align:center;

			/* Safari and Chrome */
			display:-webkit-box;
			-webkit-box-orient:horizontal;
			-webkit-box-pack:center;
			-webkit-box-align:center;

			display: box;
			box-pack: center;
			box-align: center;
		}
		
		canvas { 
			border: 1px solid black; 
		}
	</style>
	<script type="text/javascript">
		
		const UP = 38;
		const DOWN = 40;
		const RIGHT = 39;
		const LEFT = 37;

		const SQUARE_WIDTH = 10;
		const SQUARE_HEIGHT = 10;

		const GAME_WIDTH = 250;
		const GAME_HEIGHT = 250;

		function Square(x,y) {
			this.x = x;
			this.y = y;
		}

		Square.prototype.updatePosition = function(x,y) {
			this.y=y;
			this.x=x;
		}

		function SnakeBody(x,y,next) {
			this.next = next;
			Square.prototype.constructor.call(this,x,y);
		}

		SnakeBody.prototype = new Square(); 
		SnakeBody.prototype.constructor = SnakeBody;
		SnakeBody.prototype.updatePosition = function(x,y) { 
			if(this.next != null) {
				this.next.updatePosition(this.x,this.y);	
			}
			Square.prototype.updatePosition.call(this,x,y);
		}

		function Snake(x,y) { 
			this.speedY = 0;
			this.speedX = 0;
			this.body = new SnakeBody(x,y,null); 
		}

		Snake.prototype.resetSpeed = function() {
			this.speedX = 0;
			this.speedY = 0;
		}

		Snake.prototype.moveUp = function() {
			this.resetSpeed();
			this.speedY = -SQUARE_HEIGHT;
		}

		Snake.prototype.moveDown = function() {
			this.resetSpeed();
			this.speedY = SQUARE_HEIGHT;
		}

		Snake.prototype.moveLeft = function() {
			this.resetSpeed();
			this.speedX = -SQUARE_WIDTH;
		}

		Snake.prototype.moveRight = function() {
			this.resetSpeed();
			this.speedX = SQUARE_WIDTH;
		}

		Snake.prototype.addBody = function() {
			this.body = new SnakeBody(this.body,this.body.x,this.body.y);
		}

		Snake.prototype.update = function() {
			var nextX = this.body.x + this.speedX;
			var nextY = this.body.y + this.speedY;

			if(nextX > GAME_WIDTH) {
				nextX = 0;
			}

			if(nextX < 0 ) { 
				nextX = GAME_HEIGHT;
			}

			if(nextY > GAME_HEIGHT) { 
				nextY = 0; 
			}

			if(nextY < 0 ) { 
				nextY = GAME_HEIGHT;
			}
			
			this.body.updatePosition(nextX, nextY);
		}
		
		var snake = null;

		function init() { 
			document.onkeyup = onKeyUp;
			snake = new Snake(100,100);
			setInterval(onInterval, 100);
		}

		function onKeyUp(e) { 

			if(e.keyCode == UP) { 
				snake.moveUp();
			}

			if(e.keyCode == DOWN) { 
				snake.moveDown();
			}

			if(e.keyCode == LEFT) { 
				snake.moveLeft();
			}

			if(e.keyCode == RIGHT) { 
				snake.moveRight();
			}

		}

		function onInterval() {
			snake.update();
			draw();
		}

		function draw() { 
			var canvas = document.getElementById('canvas'); 
			
			if(canvas.getContext) {
				var context = canvas.getContext("2d"); 
				clearCanvas(context,canvas.width,canvas.height);
				drawSnake(context, snake.body);
			}
		}

		function drawSnake(context,body) {
			drawSquare(context,body);
			if(body.next) {
				drawSnake(context,body.next)
			}
		}

		function drawSquare(context,body) {
			context.fillRect(body.x, body.y, SQUARE_WIDTH, SQUARE_HEIGHT);
		}

		function clearCanvas(context,canvasWidth,canvasHeight) {
			// I have lots of transforms right now
			context.save();
			context.setTransform(1, 0, 0, 1, 0, 0);
			// Will always clear the right space
			context.clearRect(0, 0, canvasWidth,canvasHeight);	
			context.restore();
			// Still have my old transforms
		}

	</script>
	<body onLoad="init()">
		<div id="container">
			<canvas id="canvas" width="250" height="250"></canvas>
		</div>
	</body>

</html>